# 障害対応

---

### 当ページメタ情報

ページID：DZ-MG-HP-03

ページ名：障害対応

ファイル名：DZ-MG-HP-03_障害対応.md

ページ目的：Webサイトへのアクセス障害発生時の、対応マニュアル／初動フロー。（ログや生データはここでは含まない→GitHubにて保管）

ページ構成：ビジネス設計書＞データ管理＞HP＞障害対応

最終更新：2025/6/24

変更点：ー

---

# 💡 緊急対応BOX

以下、障害時の対応アイテム：

- ✅【初動フロー】
    
    [https://github.com/WaterMe-jp/waterme-logs/blob/c76f25a1a75c57bc403b4e2866d9478c401fb834/障害対応/initial_response.md](https://github.com/WaterMe-jp/waterme-logs/blob/c76f25a1a75c57bc403b4e2866d9478c401fb834/%E9%9A%9C%E5%AE%B3%E5%AF%BE%E5%BF%9C/initial_response.md)
    
- 📎【ログの保管先】
    
    [https://github.com/WaterMe-jp/waterme-logs/tree/c76f25a1a75c57bc403b4e2866d9478c401fb834/障害対応/logs](https://github.com/WaterMe-jp/waterme-logs/tree/c76f25a1a75c57bc403b4e2866d9478c401fb834/%E9%9A%9C%E5%AE%B3%E5%AF%BE%E5%BF%9C/logs)
    
- 🛠️【チェックリスト】
    
    [https://github.com/WaterMe-jp/waterme-logs/blob/c76f25a1a75c57bc403b4e2866d9478c401fb834/障害対応/checklist.md](https://github.com/WaterMe-jp/waterme-logs/blob/c76f25a1a75c57bc403b4e2866d9478c401fb834/%E9%9A%9C%E5%AE%B3%E5%AF%BE%E5%BF%9C/checklist.md)
    

# 障害管理方針

- GitHub＝「記録の保管庫」としてログや生データを格納。
- Notion＝「対処マニュアル・一覧表」として活用。

# 基本の初動フロー

1. **別ブラウザ（シークレット）・別端末で確認**
2. **GTmetrixなど外部ツールでアクセス検証**
3. **Xserver管理画面：WAFログ／エラーログ確認**
4. **AIOWPSファイアウォール設定・ログを確認**
5. **一時的にプラグイン無効化して再検証（対象限定）**
6. **パーミッション、.htaccessの記述確認**

※ どうしても解決しない場合：Xserverサポートに問い合わせ（障害内容＋再現条件）

# 🔧【エラー別】原因と対応フロー

| **エラーコード** | **現象** | **初動で確認すべきこと** |
| --- | --- | --- |
| **500** | サーバー内部エラー。画面が真っ白または「Internal Server Error」と表示 | `.htaccess`破損PHP処理エラープラグイン・テーマの不具合 |
| **403** | アクセス拒否。Forbiddenと表示 | WAF・セキュリティプラグイン（AIOWPSなど）SWPMのアクセス制限 |
| **404** | ページが見つからない | パーマリンク設定URL間違いページ非公開・削除の可能性 |
| **503** | 一時的なメンテナンス | サーバー自動更新中一時的な高負荷WordPress更新直後など |

---

### 🔴 500 Internal Server Error（サーバー内部エラー）

### 🔍 想定される主な原因

| **分類** | **詳細** | **備考** |
| --- | --- | --- |
| ✅ **.htaccessの記述ミス** | 不正な構文・記述ミス・文字コード不正など | 特にリダイレクトやWAF設定周辺で発生しやすい |
| ✅ **テーマ／プラグインの不整合** | アップデート不備・競合・PHPバージョン非対応など | functions.phpやカスタムコード由来も |
| ✅ **PHP実行エラー** | メモリ制限超過・致命的エラー | `error_log` を確認すると原因がわかることが多い |
| ✅ **WordPressコアファイル破損** | FTP経由での手動編集・一部消失など | `wp-config.php`や`index.php`に特に注意 |
| ⛔ サーバー過負荷 | 通常は**503**で出るため直接的原因ではない |  |

### 🧭 対処ステップ

| **ステップ** | **内容** |
| --- | --- |
| 1 | `.htaccess` を一時リネームしてアクセス確認 |
| 2 | FTPやXserverで `error_log` を確認 |
| 3 | プラグイン無効化・テーマをデフォルトに変更（FTP or wp-cli） |
| 4 | WordPressコア再インストール（wp-adminに入れる場合） |
| 5 | php.iniでの設定（`memory_limit`拡張等）も検討 |

---

### 🟠 403 Forbidden（アクセス拒否）

### 🔍 想定される主な原因

| **分類** | **詳細** | **備考** |
| --- | --- | --- |
| **✅ WAFやmod_securityの自動ブロック** | 特定のリクエストがセキュリティ検知された場合 | 管理画面操作中・フォーム送信時に多い |
| **✅ .htaccessによる制限** | IP制限、ディレクトリ制限、アクセス拒否設定など | deny from all などの記述に注意 |
| **✅ ファイル権限エラー** | 403はパーミッション（644, 755）ミスでも出やすい | サーバー操作や自動生成時に発生しがち |
| **✅ サーバー側のIP拒否設定** | 海外アクセス制限・Cloudflare設定 | 特定のネットワークのみ403になるケース |

### 🧭 対処ステップ

| **ステップ** | **内容** |
| --- | --- |
| 1 | `.htaccess`の確認・制限記述の一時除外 |
| 2 | WAFやmod_securityを一時無効化（Xserver管理画面） |
| 3 | FTPで対象ディレクトリ・ファイルの権限確認（644 / 755） |
| 4 | Cloudflare利用時はファイアウォールルールや制限範囲を確認 |

---

### 🔵 404 Not Found（ページが存在しない）

### 🔍 想定される主な原因

| **分類** | **詳細** | **備考** |
| --- | --- | --- |
| ✅ **URLの打ち間違い／削除済リンク** | 手動入力ミス、古いブックマークなど | 基本的な原因ながら多発しやすい |
| ✅ **パーマリンク設定ミス／反映漏れ** | 投稿タイプ・カテゴリ変更後など | 設定→パーマリンク→再保存で直ることも |
| ✅ **キャッシュの残骸表示** | 表示は404でも内部的には存在するケースあり | Cloudflareやブラウザキャッシュに注意 |
| ✅ **index.phpやrewriteの問題** | WordPressルートが破損している | 特に静的ページとWP併用時に発生 |

### 🧭 対処ステップ

| **ステップ** | **内容** |
| --- | --- |
| 1 | URLの再確認＋他ページ表示可否のチェック |
| 2 | WordPress管理画面→パーマリンク設定→「変更を保存」実行 |
| 3 | キャッシュ（Cloudflare／サーバー／ブラウザ）をクリア |
| 4 | `.htaccess` の rewrite ルールを初期化／再生成 |

---

### 🟣 503 Service Unavailable（サービス一時停止）

### 🔍 想定される主な原因

| **分類** | **詳細** | **備考** |
| --- | --- | --- |
| ✅ **サーバー過負荷／プロセス上限超え** | cron・バックアップ・botなど | 特に共用サーバーで発生しやすい |
| ✅ **キャッシュ系プラグインの不具合** | W3 Total Cache、LiteSpeed Cacheなど | キャッシュクリアやプラグイン無効化で解決することも |
| ✅ **WAFやセキュリティ制限の影響** | 一時的なブロック反応 | POSTリクエスト多発時に出ることあり |
| ✅ **サーバー側メンテナンス** | Xserverなどの障害・アップグレード | サーバー側通知を確認すること |

### 🧭 対処ステップ

| **ステップ** | **内容** |
| --- | --- |
| 1 | Xserverの「リソース使用状況」または障害情報を確認 |
| 2 | WAF／mod_security 一時無効化で挙動確認（後で戻す） |
| 3 | cron系の負荷分散（バックアップ頻度見直し等） |
| 4 | キャッシュ系プラグインの一時停止＋Cloudflareキャッシュクリア |

---

# 障害検証チェックリスト（詳細版）

※No.は優先順。

| **検証No.** | **確認項目** | **対象箇所** | **詳細** | **備考** |
| --- | --- | --- | --- | --- |
| 1 | robots.txt確認 | /public_html/robots.txt | /design/ や /uploads/ が Disallow: 指定されていないか | Bot制御でブロックされている可能性 |
| 2 | iframe先URLに外部メディアが直接アクセス可能か | ChatGPT→ index.html（[https://waterme.jp/wp-content/uploads/design_export/business/index.html）](https://waterme.jp/wp-content/uploads/design_export/business/index.html%EF%BC%89) | ChatGPTが index.html に直接アクセスできるか確認。ChatGPTと同様に外部からアクセスするメディアを使用して検証（例：GTmetrix／[HTTPStatus.io](http://httpstatus.io/)／Is It Down Right Now?／Web Sniffer） | ここで404ならiframe側が原因 |
| 3 | 海外IP制限 | Xserver | サーバーパネルで「海外IP制限」（特に /wp-content/ や /design/）がONになっていないか確認；OFF推奨 | サーバーパネル＞WordPress＞WordPressセキュリティ設定 |
| 4 | .htaccess設定 | /wp-content/uploads/design_export/.htaccess | フォルダ直下に制限記述がないか；FTPでアクセスし、ChatGPTのクローラー（User-Agent）をブロックしていないかを確認（必要に応じて緩和） | 特に Deny from all がないか要確認 |
| 5 | プラグイン設定（アクセス制限） | AIOWPS | 特定ディレクトリ・Bot・IPに対するブロックがないか；ログ確認・無効化して検証 | 「ファイアウォール」「7G Firewall」など |
| 6 | WAF設定確認 | Xserver | WAFが除外（OFF）設定になっているか | 有効だとBotアクセス遮断の可能性；サーバーパネル＞セキュリティ＞WAF設定 |
| 7 | WAFログ記録有無 | Xserver | ログに /design/ ブロック記録があるか確認 | 除外設定が有効に機能しているかも見極め |
| 8 | 複製テスト（元ページ） | WordPress | 「design」ページを複製し、design2などで表示検証 | 元ページ構造に問題があるか切り分け |
| 9 | iframe先URLだけ差し替え表示テスト | WordPress | 複製ページ内でiframeの src= だけ変更し表示されるか | iframeの中身だけブロックされていないか確認 |
| 10 | .htaccess設定 | /public_html/.htaccess | 上層でアクセス制限・ディレクトリブロックがされていないか | Deny from all など記述に注意 |
| 11 | OG/メタタグのrobots確認 | AIOSEO | <meta name="robots" content="noindex"> などが含まれていないか | AIOSEOの詳細設定も確認対象 |
| 12 | noindex確認 | AIOSEO | SEO設定で「インデックスさせない」になっていないか | metaタグが noindex の場合も |
| 13 | プラグイン一時停止 | AIOWPS | 一時的に無効化し、表示されるかテスト | 原因特定のための切り分け |
| 14 | パーミッション確認① | 設計書htmlファイル・フォルダ | index.html ファイルが 644 ／フォルダが 755 か | FTPまたはXserverファイルマネージャーで確認 |
| 15 | サーバーログ | Xserver | エラーログ確認；/design/ に関連するエラー有無を確認 | PHP・アクセスエラーなど |
| 16 | その他上位htaccess確認 | /wp-content/, /uploads/ | 上層ディレクトリでブロック設定されていないか | 知らずにブロックされている可能性 |
| 17 | パーミッション確認② | 固定ページ（/design/） | WordPress側で制限がかかっていないか念のため確認 | サーバー・WP両方で確認推奨 |
| 18 | パーミッション確認③ | .htaccessファイル | .htaccess 自体の権限が 644 であるか | 書き込みできる状態か確認 |
| 19 | .htaccess再生成 | WordPress | パーマリンク設定で再保存し、自動再生成を実施 | 破損時の修復処置として |
| 20 | CDNの影響確認 | CDN（使っている場合） | Xserver CDNや外部CDN使用中ならBot制限の可能性あり | 利用していなければ不要 |
| 21 | ページの公開状態 | WordPress | /design/ ページが「公開」かつ「パスワード保護なし」か確認 | 下書き／保護／削除状態の可能性排除 |
| 22 | プラグイン干渉 | SWPM | 会員制制限の影響があるか；ログアウト状態で確認 | 非会員に非表示設定の場合あり |

### 検証No.4：.htaccess設定

All in One WP Securityなどのプラグインが以下のような記述を追記していることがあります：

```
# BLOCK USER AGENTS
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteCond %{HTTP_USER_AGENT} ChatGPT [NC]
RewriteRule ^.*$ - [F,L]
</IfModule>
```

このような記述があれば**ChatGPTからのアクセスは強制403**になります。

### ● 対応策：

- FTPで `.htaccess` を確認（or WPの「AIOWPS → ファイアウォール」設定）
- 上記のようなUser-Agent制限があれば削除 or コメントアウトして保存

# 問合せ時の文章テンプレート

### 件名：

【至急】サーバー障害発生のご報告と調査依頼（ご担当者様）

---

### 本文：

Xserverサポートご担当者様

お世話になっております。

下記の通り、当方契約のサーバーにて障害が発生しております。

大変お手数ですが、至急ご確認・ご対応いただきますようお願い申し上げます。

---

■ ご契約情報

- サーバーID（会員ID）：【●●●●●●】
- ドメイン名（該当サイトURL）：【https://example.com】

---

■ 障害発生日時

- 【2024年○月○日 ○時頃 ～ 現在】

---

■ 障害の現象・内容

- 【例：トップページを含む全ページで「500 Internal Server Error」が表示され、サイトに一切アクセスできない状態です。】

---

■ 発生範囲

- 【例：全ページ／一部ページ／管理画面のみ／特定ディレクトリのみ　など】

---

■ ご自身で実施した初期対応

- 【例：.htaccess確認／プラグイン停止／キャッシュ削除／他端末・ブラウザでの確認／WAF一時無効化 など】
- 【上記対応でも症状変わらず、原因特定できないためご相談】

---

■ 備考・その他

- 【サーバーパネルや管理画面のアクセス可否、再現手順、エラー発生タイミングなど追加情報があればご記入】

---

お手数をおかけいたしますが、

至急のご調査・ご対応のほど、何卒よろしくお願い申し上げます。

---

（署名）

【お名前】

【ご連絡先メールアドレス】

【電話番号（任意）】