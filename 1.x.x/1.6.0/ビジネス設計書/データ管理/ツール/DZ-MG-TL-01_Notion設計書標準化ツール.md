# Notion設計書標準化ツール

---

### 当ページメタ情報

ページID：DZ-MG-TL-01

ページ名：Notion設計書標準化ツール

ファイル名：DZ-MG-TL-01_Notion設計書標準化ツール.md

ページ目的：Notion設計書エクスポート後のファイル群を標準化する手順やツール設計を示す。品質維持とメンテナンス性を高めることを目的とする。

ページ構成：ビジネス設計書＞データ管理＞ツール＞Notion設計書標準化ツール

最終更新：2025/6/28

変更点：ー

---

# ツール名

notions_design_normalize.py

# ✅ UI/UX

GUIエクスプローラで指定する形式。

## 画面イメージ

📌 モード選択：

(●) ALL

(　) 個別

□ フォーマット検査：メタ情報フォーマットチェック

□ もくじ生成：設計書構成mdファイル

□ リネーム：Notionエクスポートファイル名標準化

□ 変更ログ生成：変更点一覧mdファイル

## 機能一覧

| 機能名 | 実行内容 | 必須/オプション |
| --- | --- | --- |
| フォーマット検査 | メタ情報フォーマットチェック | 必須 |
| もくじ生成 | 設計書構成mdファイル | 個別時：オプション |
| リネーム | Notionエクスポートファイル名標準化 | 個別時：オプション |
| 変更ログ生成 | 変更点一覧mdファイル | 個別時：オプション |

## 仕様

- **“ALL/個別”はラジオボタン、”個別”以下の４項目はチェックボックス**
- **“ALL/個別”でモード選択**
    - デフォルト値＝“ALL”
    - デフォルト状態＝“個別”下位項目のチェック＝グレーアウト状態
- **“個別”モード選択時：**
    - チェックボックスが活性化
    - “フォーマット検査”はチェックON。変更不可。
    - “フォーマット検査”以外の機能は自由にON/OFF選択可
    - チェックなしでのsubmit→モーダル「何も選択されていません」→submitされない

## 使い方

- すべてまとめて処理したい場合は「ALL」を選んでそのまま実行
- 特定の処理だけを個別に実行したい場合は「個別」を選んでチェック

## 入力フロー

### 入力：全共通

|  | ラベル | 説明用txt |
| --- | --- | --- |
| 入力フォルダパス | 標準化対象フォルダパス | 標準化対象バージョンフォルダを選んでください。（例：c:/temp/in/NotionDesign_1.5.0） |
| 出力先フォルダパス | 出力先フォルダパス | 出力先フォルダを選んでください。（例：c:/temp/out/） |

### 入力：”変更ログ生成”機能実行時

|  | ラベル | 説明用txt |
| --- | --- | --- |
| 旧バージョンフォルダパス | 旧バージョンフォルダパス | 標準化対象バージョンフォルダの１つ前のバージョンフォルダを選んでください。（例：c:/temp/in/1.4.0） |

**※当設計書内での呼称**

便宜上、当設計書ページ内において、各フォルダを下記のとおり呼称する。

入力フォルダ：「inDir」（例：c:/temp/in/NotionDesign_1.5.0）

出力先フォルダ：「fixedrootDir」（例：c:/temp/out/）

出力先フォルダ：「fixedDir」（例：c:/temp/out/1.5.0）

旧バージョンフォルダ：「oldDir」（例：c:/temp/in/1.4.0）

# ✅ 詳細設計

**定数化する変数：**

以下、const（定数）とする変数にタグ「🔘」を付記している。

定数化の意図としては、今後の変更にも耐えうる設計に、という思想から。

**設計書HOMEファイル特定**

- 「ファイル名：」が指定const値と一致するファイルをHOMEとみなす。
- **HOME_FILENAME**をconst定義して管理。🔘
- 他にも「出力ファイル名」「サブフォルダ名」「結果ファイル名」など変更可能性のある部分はすべてconst化。

**参照▶メタ情報ルール：**

DZ-MG-DZ-03_メタ情報ルール.md

1️⃣**フォーマット検査**

1. inDir内の各.mdファイルのメタ情報を自動走査
2. 設計ルールに沿っているかを検査
    1. メタ情報ルール参照
    2. 検査時の挙動
        1. 検査OK→検査フラグ”T”
        2. 検査NG→検査フラグ”F”
3. 検査結果を出力
    1. 検査フラグ”T”時：
        1. モーダル出力「【検証OK】全ページメタ情報、フォーマット形式のとおりです」
    2. 検査フラグ”F”時：
        1. mdファイルに詳細記載→出力
            1. 出力先は”(fixedrootDir)/”固定
            2. ファイル名”chkresult.md”を初期値。🔘定数。
        2. mdファイル出力イメージ
            1. メタ情報ルールに対する検査結果を出力する
                
                ```
                # フォーマット検証結果
                対象フォルダ：1.5.0
                検証日時：xxxx.xx.xx xx:xx
                以下ページの項目がメタ情報フォーマットに則らない形式であると識別されました。
                
                ### DZ-DS-CT-F01_HP制作講座.md
                ファイル名：ruleNo.5-ファイル名がルール一致しません
                最終更新：ruleNo.3-値が存在しません
                
                ### DZ-DS-CT-G00_特典.md
                （全体）ruleNo.1-フォーマット形式に則っていません
                ページ名：ruleNo.4-ページタイトルと一致しません
                変更点：ruleNo.3-値が存在しません
                
                ```
                
        3. モーダル出力「【検証NG】“検査結果は、(fixedrootDir)/(ファイル名).md”をご覧ください」

**エラー時の挙動：**

1. 検査フラグ”T”／”F”に伴う検査ストップはしない。検査は結果がFalseでも全ファイル分実施する。
2. 異常エラー時のみ、モーダルでエラー内容を表示して実行停止する。

**検査フラグに伴う挙動：**

1. **検査フラグ“T”時のみ、以降の機能（もくじ生成・リネーム・変更ログ生成）に進むことができる。**

---

2️⃣ **もくじ生成**

1. inDir内の各.mdファイルのメタ情報を自動走査
2. データを取得し、目次一覧表化する
    1. ページID
    2. ページ名
    3. パス構成（相対パス）
3. mdファイルにメタ情報＆目次一覧表記載→出力
    1. メタ情報ルールに則り、メタ情報を自動追記する
        1. ページ名：設計書構成
        2. ページID：DZ-MG-DZ-01
        3. ファイル名：DZ-MG-DZ-01_設計書構成.md
    2. 出力先は”(fixedrootDir)/”固定
        1. ファイル名”structure.md”を初期値。🔘定数。
    3. mdファイル出力イメージ
        
        特に指定はありません。ChatGPTにお任せします。
        

例：GitHub公開用のREADME補助、設計書レビュー時の初めのロード利用などを想定。

---

3️⃣ **リネーム**

※更新時点で最新のrename_notions_gui_recursive.pyと同じ仕様です。

1. 中間フォルダのランダム文字列除去
2. ファイル名を「ファイル名：」行から決定
3. HOMEファイルから「version：」を取得→出力フォルダ名自動命名
    1. versionがなければoutフォルダ名を初期値採用
4. 出力フォルダ名をversion名に自動設定
5. ファイル名重複時は _1, _2 ... で自動回避

---

4️⃣ **変更ログ生成**

1. inDirとoldDirを比較
2. inDir＞HOMEファイルから各値取得→H2タグでmdファイルに出力
    1. [version：]
    2. [最終更新：]
3. inDirとoldDir間で、同名ファイル同士の「変更点：」行を比較→差分をmdファイルに出力
    1. 差分を抽出
        1. 差分有無を検出したら、**「変更点：」行の全内容を出力**。
        2. 旧にない新ファイルからの「追加分だけを抽出」ではなく、**新の全行を出す**。
    2. indir基準になるよう、差分をmdファイル出力

**出力mdファイルについて**

1. 既存CHANGELOG.md　（追記 or なければ新規生成）
2. 出力先は”(fixedrootDir)/CHANGELOG.md”
3. ファイル名”CHANGELOG.md”を初期値。🔘定数。

**出力mdファイル追記位置**

1. 既存ファイルがある場合、「# CHANGELOG.md」以下の**最上部に追記**（逆順履歴）。
2. 上に最新がくる形。

**ファイル出力イメージ**

```
# CHANGELOG.md

    ## 1.5.1 (2025/07/01)
    ### DZ-SC-00 スケジュール
    - 進捗評価項目を詳細化
    - 進行管理フロー図リンクを追加
    ### DZ-ST-00 構想・展望
    - 法人化構想セクションを加筆

    ## 1.5.0 (2025/07/01)
    ### DZ-SC-00 スケジュール
    - README.md作成
```

---

## ⚙️ 共通要件

- 全角/半角の「：」揺れ対応
- 空ファイルスキップ
    - 中身0バイトファイルは全処理スキップ。
    - 例外も想定しつつコードコメントにも明記。
- Windowsパス長制限に配慮

---

# ✅ コード／技術仕様

### CLI挙動

- いまはGUIのみ優先対応
- 将来CLI化も想定しつつ、コードを関数分離＆可読性担保した設計

### ファイル構成

- 1ファイル構成（notions_design_normalize.py）
- 内部関数をモジュール的に分離して可読性を維持
- 冒頭にdocstringでメタ情報を明記
- 可能な範囲でコメントも追加

### その他

- 出力先の既存フォルダがあれば削除
- ファイル名重複時は _1, _2 付与
- 全角/半角「：」対応、空白削除、Windowsパス長制限などは従来仕様を継続
    - 全角半角「：」揺れ対応
    - パス長制限に注意
- const値をファイル冒頭近くにまとめて明記
- 今後も「設計書＞データ管理＞ツール＞設計書エクスポート標準化ツール」ページのドキュメントとコードをリンクして保守しやすく

---

# ✅ 運用イメージ

1️⃣ Notionで設計書をエクスポート

2️⃣ ZIP展開

3️⃣ 本ツールを起動

4️⃣ 一括でフォーマット検査・もくじ生成・リネーム・変更ログ生成