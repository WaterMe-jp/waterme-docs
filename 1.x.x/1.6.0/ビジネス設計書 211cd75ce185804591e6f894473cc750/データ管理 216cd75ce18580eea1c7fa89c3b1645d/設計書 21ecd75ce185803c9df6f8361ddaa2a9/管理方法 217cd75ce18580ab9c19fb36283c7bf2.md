# 管理方法

---

### 当ページメタ情報

ページID：DZ-MG-DZ-04

ページ名：管理方法

ファイル名：DZ-MG-AL-04_管理方法.md

ページ目的：設計書の管理方法を示す。また、設計書へのアクセス障害時の対応も併せて示す。

ページ構成：ビジネス設計書＞データ管理＞設計書＞管理方法

最終更新：2025/6/27

変更点：ー

---

# 概要

✅ 本ページはWaterMe設計書の【運用ガイドライン】です。
✅ Notion執筆→GitHub管理→ChatGPTレビューまでの手順を標準化しています。

WaterMeプロジェクトの設計書（現在表示しているこの内容）は、Notion上で作成・編集する。

また、基本的にChatGPTにレビューを受ける形で詳細を固めていく方針。

**GitHub＞waterme-docsリポジトリ上に保管し、普段はprivate運用、レビュー時のみpublic切替**としてChatGPTレビューを受ける形式とする。

※本ページは今後の運用改善に合わせて随時アップデートしていきます。

# レビュー時ステップ

1. **Notionエクスポート**
    1. zip展開　※下記①参照
2. **リネーム処理**
    1. リネーム用ツールを利用　※下記②参照
3. **リネーム済み設計書をGitHub＞waterme-docsリポジトリにプッシュ**
    1. GitHub上でpublicに切替　※下記③参照
4. **ChatGPTにレビュー依頼**
5. **GitHub＞waterme-docsリポジトリをprivateへ変更**

---

## ①Notionエクスポート手順

### zip展開

※PC環境：win11

1. 設計書zipフォルダ上で右クリック→メニュー
2. [その他のオプションを確認]
3. [7-Zip]→[展開]→任意の設定→展開実行

※初期搭載の展開システムではエラーが発生するため、7-Zipアプリを使用。

### エクスポート設定

以下の流れでNotionから設計書をエクスポートしてください。

1️⃣ **設計書HOMEページへ移動**

2️⃣ 画面右上の **[・・・]（三点リーダーメニュー）** をクリック

3️⃣ 「**エクスポート**」を選択

4️⃣ ポップアップ画面で以下のように設定

- **エクスポート形式**：マークダウンとCSV
- **データベースを含める**：現在のビュー
- **対象コンテンツ**：すべて
- **サブページを含める**：ON
- **サブページのフォルダーを作成**：ON

5️⃣ 「**エクスポート**」をクリックし、生成されたZIPをダウンロード

---

## ②リネーム処理手順

エクスポートしたZIPを解凍した後、以下の流れでファイル名を整えます。

1️⃣ **解凍済フォルダを準備**

- ZIPを解凍し、中身をわかりやすい短いパス（例：`C:/in`）に配置

2️⃣ **VSCodeを起動**

- 該当プロジェクト（例：`waterme-scripts`）を開く
- ターミナルをbashに切り替える

3️⃣ **toolsフォルダへ移動**

```bash
bash
コピーする編集する
cd waterme-scripts/tools

```

4️⃣ **リネームツールを実行**

```bash
bash
コピーする編集する
python rename_notions_gui_recursive.py

```

5️⃣ **GUIが起動**

- **入力フォルダ**：解凍したNotionエクスポートフォルダを選択
- **出力先フォルダ**：結果を保存したい親フォルダを選択
- 例：`C:/out` など、パスが短い場所を推奨

6️⃣ **実行ボタンを押す**

- 自動でコピー＋リネームが行われ、指定した出力先にバージョン名フォルダが生成されます

## ⚠️ 注意点まとめ

- **Windowsパス長制限（260文字）** に注意
    - フォルダパス全体が長いと処理エラーが発生します
    - なるべくルートに近い短いパスを指定してください
    - 例：`C:/in`、`C:/out`
- **Notionエクスポート設定時に「サブページのフォルダーを作成」をOFFにする**
    - サブフォルダ構造を防ぎ、パス深度を浅く保ちます
- **設計書HOMEファイル内に必ず「version：」を記載**
    - 例：`version：v1.3.0`
    - 出力フォルダ名に自動で反映され、バージョン管理が容易になります
- **ファイル名重複時は自動で `_1`, `_2` ... を付与**
    - 安心して一括処理できます

---

## ③GitHub管理

## 管理基本方針

### 基本方針

- **普段はPrivate管理**
- **レビュー時のみ一時的にPublic化**
- **レビュー完了後すぐPrivateに戻す**

---

### 運用ステップ例

1.  （普段：Privateリポジトリで設計書をバージョン管理）
2. ChatGPTレビュー前に「Public」に切り替え
3. ChatGPTにURLを渡してレビュー依頼
4. ChatGPTからフィードバックを得たらすぐ「Private」に戻す

---

### リスク低減ポイント

- 公開期間を**必要最低限に限定**
- 公開中はURLを**外部にシェアしない**
- 検索エンジンのクロールは短期公開ではほぼ入らない
- 秘密情報（APIキー、パスワードなど）は**最初から含めない**

---

### 管理Tips

- リポジトリ名をわかりにくくする（例：wm-docs-2025x）
- READMEにnoindexメタを入れておく
- 公開時にNotionで管理ログを残す

---

## バージョン更新時のステップ

1. 新規設計書(x.x.x)をNotionエクスポートで生成
    1. エクスポート→zip展開→リネームツールでリネーム
2. ローカルリポジトリwaterme-docs/x.x.x/ に上記1.をコピー
3. x.x.xに対して、変更点（詳細）を追記
    1. x.x.x/CHANGELOG.md
4. リポジトリ全体に対して、変更点（概要）を追記
    1. ルートREADME.md＞バージョン履歴
5. リモートへプッシュ

## README.mdのnoindex例文

---

> GitHub上のリポジトリ直下にあるREADME.mdの冒頭に貼ることで、検索エンジンに「インデックスしないで」を伝えるヒントを与えられます。
> 

✅ 例文（Markdown形式）

```markdown
markdown
コピーする編集する
<!--
<meta name="robots" content="noindex">
-->

# WaterMe 設計書リポジトリ

このリポジトリはChatGPTレビュー用途の一時的公開を想定しています。
無断複製を禁止し、許可されたレビュアー以外の利用をお控えください。

```

✅ ポイント

- `<!-- ... -->`でコメント化することでMarkdownビューで目立たない
- 検索エンジンによってはこのメタを尊重し、インデックスを控える
- **ただし保証はなく、あくまで「抑止」レベル**

---

## Public/Private切替マニュアル

### GitHub UIでの切り替え手順

1. GitHub上で対象リポジトリを開く
2. `Settings` タブをクリック
3. `Danger Zone` セクションまでスクロール
4. 「Change visibility」を選択
5. Private ⇄ Publicを切り替えてConfirm

**注意点**

- 切替は即時反映
- Public化すると誰でもURLでアクセス可能
- Private化に戻すとURLを知っていても非公開になる
- Cloneされた場合はローカルにコピーが残るので注意

### おすすめ運用例

- **Private運用がデフォルト**
- ChatGPTレビュー前だけPublic化
- Review完了後は即Privateに戻す
- 公開中もSNSやブログなど外部へのURL共有を避ける

---

# GitHub管理採用の経緯

### ChatGPT projドキュメントへの全ファイル共有＝NG

設計書はNotionエクスポートして、ChatGPT＞WaterMe proj＞ドキュメント内にすべて保存する算段だったが、現在のChatGPT仕様上非対応だった。
※下記、参考＞[設計書→ChatGPT内共有　※結果NG] 欄を参照。

### Xserver自サイトへのAIアクセス＝AIアクセス障害が頻回でNG

過去にXserver＞[自サイト] ＞専用の固定ページで表示 という形式で保存してChatGPTレビューを実施していたが、Xserver仕様によりAIアクセス拒否が頻回に起こり、ChatGPTモデルや条件により再現性や原因特定も難しく、安定的運用が難しいと判断。

※下記、参考＞[設計書→Xserver共有　※結果NG] 欄を参照。

# 参考

# 設計書→ChatGPT内共有　※結果NG

## 詳細記録

共有試行日：2025.6.27 

### ✅ 背景・目的

- WaterMe設計書（約90枚の.mdファイル）をChatGPTに安全に一括保存し、随時レビューを依頼する運用を目指した
- ChatGPTの「プロジェクト」機能に「ドキュメント」をアップロードすることで、AIが常に全設計書を参照できる状態を作ろうと試みた

---

### ✅ 試した手順（概要）

- 1ファイルずつアップロード→アプリを再起動→アップロード済みを確認
- キャッシュ負荷を減らし、サーバー保存を確実化するための運用サイクルを設計

---

### ✅ 主な検証結果

- 10枚目までは問題なく保存可能
- 11枚目以降のアップロード時に「99%で止まる」「サーバーエラー」が再現
- Web版、デスクトップ版（Windows）、スマホ版など複数クライアントで同様の挙動を確認
- 全ファイル削除→再起動→再アップロードを試行するも、再現性高く10件前後で保存失敗

---

### ✅ 技術的背景（原因の推測）

- ChatGPTアプリの仕様上、プロジェクトファイル画面で「全ファイル情報を一括バッチ送信」する仕組み
- 保存時に10枚以上のファイルを同時に再送信しようとしてタイムアウトやメモリオーバー
- 内部キャッシュを再起動で一時リセットしても、読み込み時に既存ファイルを再取得するため結局上限を超える

---

### ✅ 試した工夫

- 1枚ずつアップロード＋再起動
- ファイルの軽量化
- アプリ全再起動、キャッシュクリア
- Web版とデスクトップ版の切り替え

→ すべて根本解決には至らず

---

### ✅ 今後の見通し

- 現行ChatGPT「プロジェクト」機能のUI/仕様では、10枚以上のドキュメント一括管理は現実的に困難
- 将来的に「部分アップロード」「ファイル単位保存」「ページリンクによる遅延読み込み」などのアップデートがあれば解決余地はある
- 現在は「設計書全体の一括管理」は難しく、「検討中テーマごとの小分割保存」が限界運用

---

### ✅ まとめ・決定方針

- ChatGPTプロジェクトドキュメント共有は「全設計書の包括管理」用途では断念
- 代替策として **GitHubリポジトリを設計書母艦として管理し、必要に応じてChatGPTへURLを共有する運用** に移行

---

 **ポイント**

- ChatGPTプロジェクトファイルは「10枚以内のホットなテーマ検討」に最適
- 大量ファイルの長期保存はGitHub管理が現実的
- 設計書管理の役割分担を明確に設計し、今後の拡張性を担保する

---

---

## 今後改善時の実施ステップ

もし今後、ChatGPT＞proj＞ドキュメントに大量ファイルをアップロードできるよう仕様改善した場合は、設計書保管＋レビューを一元化できるので見当も視野に入れる。

## 🔄 レビュー時ステップ

1. **Notionエクスポート**
    1. zip展開　※下記参照
2. **リネーム処理**
    1. リネーム用ツールを利用　※下記参照
3. **ChatGPT＞WaterMe proj＞ドキュメントにアップロード**
    1. “一度に20ファイルまで”制約があるので、何度かに分けること
4. **ChatGPTにレビュー依頼**

---

## 【Notionエクスポート】手順

### zip展開

※PC環境：win11

1. 設計書zipフォルダ上で右クリック→メニュー
2. [その他のオプションを確認]
3. [7-Zip]→[展開]→任意の設定→展開実行

※初期搭載の展開システムではエラーが発生するため、7-Zipアプリを使用。

### エクスポート設定

以下の流れでNotionから設計書をエクスポートしてください。

1️⃣ **設計書HOMEページへ移動**

2️⃣ 画面右上の **[・・・]（三点リーダーメニュー）** をクリック

3️⃣ 「**エクスポート**」を選択

4️⃣ ポップアップ画面で以下のように設定

- **エクスポート形式**：マークダウンとCSV
- **データベースを含める**：現在のビュー
- **対象コンテンツ**：すべて
- **サブページを含める**：ON
- **サブページのフォルダーを作成**：OFF ← ⚠️必ずOFFに設定
    - これによりフォルダ階層が深くなることを防ぎ、パス長制限エラーを回避します。

5️⃣ 「**エクスポート**」をクリックし、生成されたZIPをダウンロード

## ⚠️ 注意点まとめ

- **Windowsパス長制限（260文字）** に注意
    - フォルダパス全体が長いと処理エラーが発生します
    - なるべくルートに近い短いパスを指定してください
    - 例：`C:/in`、`C:/out`
- **Notionエクスポート設定時に「サブページのフォルダーを作成」をOFFにする**
    - サブフォルダ構造を防ぎ、パス深度を浅く保ちます
- **設計書HOMEファイル内に必ず「version：」を記載**
    - 例：`version：v1.3.0`
    - 出力フォルダ名に自動で反映され、バージョン管理が容易になります
- **ファイル名重複時は自動で `_1`, `_2` ... を付与**
    - 安心して一括処理できます

---

## 【リネーム処理】手順

エクスポートしたZIPを解凍した後、以下の流れでファイル名を整えます。

1️⃣ **解凍済フォルダを準備**

- ZIPを解凍し、中身をわかりやすい短いパス（例：`C:/in`）に配置

2️⃣ **VSCodeを起動**

- 該当プロジェクト（例：`waterme-scripts`）を開く
- ターミナルをbashに切り替える

3️⃣ **toolsフォルダへ移動**

```bash
bash
コピーする編集する
cd waterme-scripts/tools

```

4️⃣ **リネームツールを実行**

```bash
bash
コピーする編集する
python rename_notions_gui_recursive.py

```

5️⃣ **GUIが起動**

- **入力フォルダ**：解凍したNotionエクスポートフォルダを選択
- **出力先フォルダ**：結果を保存したい親フォルダを選択
- 例：`C:/out` など、パスが短い場所を推奨

6️⃣ **実行ボタンを押す**

- 自動でコピー＋リネームが行われ、指定した出力先にバージョン名フォルダが生成されます

---

## ChatGPTドキュメントアップロード

### ✅ 概要

以下は、WaterMe設計書.mdファイルをChatGPT（プロジェクトファイル）へ安全に保存する際の推奨手順です。

特に**10枚以上の大量ファイルをアップロードする場合。**現状のChatGPT UI仕様上「99%でフリーズする」などの**エラーが起きやすく**、それを回避するための具体的運用フローです。

---

### ✅ 手順（1ファイルずつアップロード→保存確定→再起動）

1. ChatGPTアプリを起動し、対象プロジェクト（例：WaterMe）を開く
2. [プロジェクトファイル]を開く
3. 右上の[ファイルを追加する]をクリック
4. 追加したい1枚の.mdファイルを選択
5. アップロード進行インジケータが100%になるまで待つ
→ ファイルリストに新しいファイルが表示されるのを確認
6. アプリを**完全に閉じる**（×で終了）
7. ChatGPTアプリを再起動
8. WaterMeプロジェクトを再度開き、アップロード済みファイルが正しくリストに残っていることを確認
9. 以降、次の1枚を同様にアップロード

**この手順で：**

- アップロード時のキャッシュ肥大化をリセット
- サーバー側の保存処理を確実化
- 「99%フリーズ」問題を完全回避

**運用ヒント：**

- 10枚くらい連続でアップロードしたら、特に念のため再起動を挟む
- サーバー保存確認後は、再アップロード不要
- 途中でアプリ落ちやフリーズした場合も、再起動後に「保存済みファイルが残っているか」を必ず確認

---

### ✅ 背景：ChatGPT技術的仕様

現状のChatGPTアプリでは、ドキュメント管理は以下のような仕組みで動いています。

**1.「ファイルを追加する」ボタンの動作**

- このボタンを押してファイルを選択した瞬間にアップロード開始
- 「保存」ボタンはなく、内部的には**自動保存**される
- 進捗インジケータ（クルクル99%）はサーバーへの保存完了を待つ状態

**2.「保存完了」とは？**

- サーバー上にファイル情報が反映
- アプリを再起動しても、そのファイルがファイルリストに表示される状態

**3. 10件以上になると起きやすい現象**

- ChatGPTアプリのドキュメント管理画面は、**現在読み込んでいる全ファイル情報をメモリで保持**
- 新規ファイルアップロード時、内部では「既存ファイル全リスト＋新規ファイル」を**まとめてサーバーへ送信**する
- 10枚以上表示されている状態でのアップロードでは、このバッチ処理の負荷が大きくなり、タイムアウト・UIフリーズが発生しやすい

**4. 具体的なトラブル例**

- 11枚目をアップしようとすると「99%で止まる」
- 10枚目までなら一度に通る
- 「10枚をまとめてアップしようとした状態で途中保存が失敗した残骸情報」がキャッシュされ、次のアップロードで内部的に連続保存しようとして失敗するケースもある

**5. このための「再起動」という解決策**

- アプリを終了して再起動することで
    - メモリ上のキャッシュをクリア
    - 未保存状態のゴミ情報をリセット
- 再起動後は「サーバーに完全保存されているファイルだけ」が読み込まれる
- 1枚ずつアップロード→再起動を挟むサイクルで「常に1件分の確実な保存」になる

---

### ✅ 運用まとめ（推奨ルール）

- **1ファイルずつアップロード→保存→アプリ再起動**
    - 現時点で最も安全
- アップロード進行が100%で完了し、リストに表示されたらサーバー保存完了
- 保存確認後の再アップロードは不要
- 大量ファイル（50〜100枚規模）でも、**小分割アップロードを繰り返せば全部保存可能**
- サーバー上に保存済みのファイルは、後から削除/更新も可能
- アプリ再起動でキャッシュクリアを習慣化する

---

---

---

# 設計書→Xserver共有　※結果NG

ChatGPTのレビュー分析を基に設計書作成進行する。

## レビュー用ページ

WordPress ＞ [固定ページ] ＞ [設計レビュー]ページ

```jsx
<iframe src="[https://waterme.jp/wp-content/uploads/design_export/business/index.html](https://waterme.jp/wp-content/uploads/design_export/business/index.html)"
width="100%" height="1200" style="border: none;"></iframe>
```

ここでNotionのデータを表示する仕組みであり、
この[設計レビュー]ページのリンクをChatGPTに見てもらう流れ。

## レビューステップ

1. **Notionで設計書を作成**
2. **Notion設計書データをHTML化**
    1. Notion＞[ビジネス設計書]ページを選択
    2. 右上[三点リーダ]＞[エクスポート]＞[HTML, サブページを含める, サブページのフォルダーを作成]＞[エクスポート]実行
    3. エクスポートされたzip展開する
    4. ベースフォルダ名を[business]に変更
    5. business＞htmlファイル名を「index.html」に変更
3. **サーバーに公開**
    1. 本番サーバーのファイルマネージャを開く
    2. この階層形式で、[business]フォルダを配置。
        
        ```jsx
        /wp-content/uploads/design_export/business/
        ```
        
    
4. **レビュー実施**
    1. ChatGPTに下記URLを伝えて、レビュー依頼
        
        ```jsx
        https://waterme.jp/design/
        ```
        
5. **レビュー後**
    1. 本番サーバーのファイルマネージャから**[business]フォルダを削除**
        
        ※第三者への秘匿性を維持するため
        

## レビュー時の注意点－情報漏洩について

- APIキーや認証情報を含むデータは **絶対に埋め込まない**
- AIによるレビュー対象は **設計書の表層構造や導線のみ** に限定

## レビュー障害時：一時的アクセス障害

[障害対応](../HP%2021ecd75ce18580899335d492a003982b/%E9%9A%9C%E5%AE%B3%E5%AF%BE%E5%BF%9C%20217cd75ce18580c2b2a5d6a3eda37238.md)

## レビュー障害時：恒久的アクセス障害

### 想定状況

- 設計書（`https://waterme.jp/design/` や `iframe内index.html` ）へのアクセスが拒否される
- 本体を読み込むことができないため、設計書の中身レビューが不可能

### 代替策：**第三者サービスへの一時避難＋リンク共有方式**

| 手段 | 説明 | 備考 |
| --- | --- | --- |
| **A. GitHub Pagesでホスティング** | 設計書HTMLやPDFを `GitHub Pages` で静的公開し、URL共有 | ファイル単体であれば軽量・高速 |
| **B. Google Drive経由のPDF共有** | 設計書PDFを「リンクを知っている人に限定」で公開し、URLを共有 | 実績あり。ChatGPTからも一部閲覧可能 |
| **C. Notionで再構成・公開** | 設計書をNotionで再構成 → 「全体公開リンク」で共有 | ただしアクセスできない可能性あり（先日のNotion事象） |
| **D. GitHubリポジトリ内に設計書を設置** | MarkdownやHTMLとして構成しておけば、ChatGPTが直接解析可能 | 特に `README.md` にまとめると理想的 |

### おすすめは？

- 将来も活かせる構成としては**GitHub Pages**または**Notion**（ただしNotionはアクセス可否注意）
- 簡易対応なら**Google Drive（PDF）**が最も確実で即効性あり

### 原因例

| 要因 | 備考 |
| --- | --- |
| `.htaccess`によるUser-Agent遮断 | `ChatGPT`などを含むUser-Agentをブロックしている可能性 |
| WAFやセキュリティプラグインによる遮断 | 一定回数以上のBotアクセスをブロックする自動検知 |
| サーバー側ブラックリスト登録 | AI経由のアクセスが不正とみなされ、遮断登録された可能性 |
| IP帯ごと遮断 | 特定の海外IP帯からのアクセスが拒否されている |

これらがCloudFlareなどでプロキシ化されれば回避可能になる場合があります。

### 参考：原因－方式別

- **iframe表示**：
    - AI（ChatGPTなど）からのアクセス時、iframe内のHTMLが**JSレンダリング依存**だと表示不可となるケースがある。
    - ChatGPTはJS実行不可のため、**静的HTMLで構成された設計書表示**が望ましい。
    - セキュリティ設定（例：X-Frame-Options）でiframeがブロックされていると表示不可。
- **HTML直リンクアクセス**：
    - AIは直リンク（例：`/wp-content/uploads/design_export/index.html`）へのアクセスは比較的安定。
    - ただし、サーバー側が「Bot」として遮断（403/500）するケースあり。
    - `.htaccess` やセキュリティプラグインでの制限有無を要確認。
- **Cloudflare経由アクセス**（導入検討中）：
    - **アクセス安定性が向上**する可能性がある。
    - CloudflareがAIアクセス元のIPを代表するため、**Xserver側ではCloudflareのIPをホワイトリスト化**すれば安定が見込まれる。
    - WAFやBot防御設定に注意が必要（Cloudflare側の設定含め調整）。

## 参照：障害ログ

TODO：☟障害ログをGitHub上で一元管理するよう修正。

- ChatGPT→Notionへのアクセス障害[保留]